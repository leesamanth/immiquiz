<!DOCTYPE html>
<html lang="en" ng-app="quizApp">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>US Citizenship Quiz - Flashcards</title>
    <meta
      name="description"
      content="Practice US citizenship test questions and answers. Review flashcards, take quizzes, and prepare for your naturalization interview with immiquiz.com."
    />
    <meta
      name="keywords"
      content="US citizenship, quiz, flashcards, naturalization, practice test, immigration, civics, questions, answers"
    />
    <meta name="author" content="immiquiz.com" />
    <meta
      property="og:title"
      content="US Citizenship Quiz - Practice Questions & Flashcards"
    />
    <meta
      property="og:description"
      content="Practice US citizenship test questions and answers. Review flashcards, take quizzes, and prepare for your naturalization interview with immiquiz.com."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://immiquiz.com/" />
    <meta property="og:image" content="https://immiquiz.com/images/logo2.svg" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="US Citizenship Quiz - Practice Questions & Flashcards"
    />
    <meta
      name="twitter:description"
      content="Practice US citizenship test questions and answers. Review flashcards, take quizzes, and prepare for your naturalization interview with immiquiz.com."
    />
    <meta
      name="twitter:image"
      content="https://immiquiz.com/images/logo2.svg"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-DZ4QLE2QX7"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #fff;
        font-family: sans-serif;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        padding: 2rem 3rem;
        margin-bottom: 2rem;
        text-align: center;
      }
      .btn {
        background: #0056b3;
        color: #fafafa;
        border: 1px solid #0056b3;
        border-radius: 8px;
        padding: 0.5rem 1.5rem;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
        margin: 0.5rem;
      }
      .answer-btn {
        background: #fafafa;
        color: #020202;
        border: 1px solid #0056b3;
        border-radius: 8px;
        padding: 0.5rem 1.5rem;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
        margin: 0.5rem;
      }
      .answer-btn.selected {
        background: #00b356;
        font-weight: bold;
      }
      .answer-btn.correct {
        background: #28a745;
      }
      .answer-btn.incorrect {
        background: #dc3545;
      }
      .submit-btn {
        background: #28a745;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0.5rem 1.5rem;
        font-size: 1rem;
        cursor: pointer;
        margin-top: 1rem;
      }
      .result {
        font-size: 1.2rem;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <div
      class="container mx-auto px-4 py-0"
      ng-controller="FlashCardController"
    >
      <div class="header">
        <nav class="flex items-center justify-between p-4 bg-white">
          <div class="flex items-center space-x-8">
            <!-- Hamburger button for mobile, now left-aligned -->
            <button
              title="Toggle menu"
              class="md:hidden mr-2 focus:outline-none"
              ng-click="menuOpen = !menuOpen"
            >
              <svg
                class="w-8 h-8 text-gray-700"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                ></path>
              </svg>
            </button>
            <img
              src="images/logo2.svg"
              alt="Immigration Quiz Logo"
              class="logo"
            />
            <!-- Menu for desktop -->
            <ul class="hidden md:flex space-x-6">
              <li><a href="index.html" class="font-bold text-lg"> Home </a></li>
              <li>
                <a href="store.html" class="font-bold text-lg"> Store </a>
              </li>
              <li>
                <a href="about.html" class="font-bold text-lg"> About </a>
              </li>
            </ul>
          </div>
          <!-- Mobile drawer -->
          <div
            ng-show="menuOpen"
            class="md:hidden absolute top-16 left-0 w-full bg-white shadow-lg z-50"
          >
            <ul class="flex flex-col items-center py-4 space-y-2">
              <li>
                <a
                  href="index.html"
                  class="font-bold text-lg block w-full px-4 py-2"
                >
                  Home
                </a>
              </li>
              <li>
                <a
                  href="store.html"
                  class="font-bold text-lg block w-full px-4 py-2"
                >
                  Store
                </a>
              </li>
              <li>
                <a
                  href="about.html"
                  class="font-bold text-lg block w-full px-4 py-2"
                >
                  About
                </a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="mx-auto px-4 py-8 flex flex-col md:flex-row">
        <main class="flex-1 min-w-0">
          <div class="container mx-auto px-4 py-8">
            <div class="flex justify-end mb-4">
              <label class="flex items-center space-x-2">
                <input
                  type="checkbox"
                  ng-model="readOutEnabled"
                  ng-change="onReadOutToggle()"
                />
                <span class="text-sm">Read question out loud</span>
              </label>
            </div>
          </div>
          <!-- State/Territory selection dropdown shown on page load -->
          <div
            ng-if="!selection.selectedState || selection.selectedState === '-' || selection.selectedState === ''"
            class="card border-2 border-blue-200 rounded-3xl mb-8"
          >
            <label for="stateTerritorySelect" class="block mb-2 font-semibold"
              >Select your state or territory:</label
            >
            <select
              id="stateTerritorySelect"
              ng-model="selection.selectedState"
              ng-change="onStateSelectionChange()"
              ng-options="item.abbreviation as item.name for item in combinedStatesTerritories track by item.abbreviation"
              class="border rounded px-3 py-2 mb-4 w-full"
            >
              <option value="">-- Choose State or Territory --</option>
            </select>
          </div>
          <!-- Flashcards shown only after selection -->
          <div
            class="mt-6"
            ng-if="selection.selectedState && selection.selectedState !== '-' && selection.selectedState !== ''"
          >
            <div
              class="card drop-shadow-amber-50 border-2 border-amber-200 rounded-3xl"
            >
              <div class="question" ng-bind="currentQuestion.question"></div>
              <div class="options">
                <div class="italic text-gray-500" ng-if="!showAnswers">
                  practice saying the answer out loud
                </div>
                <div ng-if="!showAnswers">
                  <div>
                    <button class="btn btn-primary" ng-click="showAnswersFn()">
                      Show Answers
                    </button>
                  </div>
                </div>
              </div>
              <div ng-if="showAnswers" class="pt-5">
                <ul class="list-none p-0 m-0">
                  <li
                    class="border-2 border-b-green-900 rounded-lg p-2 m-1 w-full"
                    ng-repeat="option in currentOptions"
                  >
                    {{ option }}
                  </li>
                </ul>
                <div ng-if="currentQuestion.disclaimer">
                  <p class="text-sm text-gray-500">
                    {{ currentQuestion.disclaimer }}
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="grid place-items-end">
            <button class="btn btn-primary" ng-click="nextQuestion()">
              Next Question
            </button>
          </div>
        </main>
        <aside
          class="w-full md:w-1/3 md:pl-8 mt-8 md:mt-0 max-h-160 overflow-y-scroll"
        ></aside>
      </div>
    </div>
    <script>
      angular
        .module("quizApp", [])
        .controller("FlashCardController", function ($scope, $http, $timeout) {
          $scope.questions = [];
          $scope.flashCardQuestions = [];
          $scope.currentIndex = 0;
          $scope.currentQuestion = null;
          $scope.currentOptions = [];
          $scope.selectedOptions = [];
          $scope.showAnswers = false;
          $scope.requiresAdditionalInput = false;
          $scope.flashCardsFinished = false;
          $scope.score = 0;
          $scope.answeredQuestions = [];
          $scope.readOutEnabled = false;
          $scope.totalQuestions = 100;
          $scope.selection = { selectedState: null };
          $scope.states = [];
          $scope.territories = [];
          $scope.combinedStatesTerritories = [];
          $scope.governors = [];
          $scope.capitals = [];
          $scope.congressByState = {};
          $scope.congressDataLoading = false;

          $scope.onStateSelectionChange = function () {
            loadQuestion();
          };

          $scope.onReadOutToggle = function () {
            if (
              $scope.readOutEnabled &&
              $scope.currentQuestion &&
              $scope.currentQuestion.question
            ) {
              $timeout(function () {
                speak($scope.currentQuestion.question);
              }, 100);
            } else {
              if (window.speechSynthesis) window.speechSynthesis.cancel();
            }
          };

          $http.get("questions.json").then(
            function (response) {
              // Flatten all questions from all sections
              var allQuestions = [];
              if (Array.isArray(response.data)) {
                response.data.forEach(function (q) {
                  allQuestions.push(q);
                });
                $scope.questions = allQuestions;
                // .filter(function (q) {
                //   return q.requiresState === true;
                // });
                //start flashcards
                startFlashcards();
              } else {
                $scope.questions = [];
                $scope.quizFinished = true;
                alert("Error: questions.json is not in the expected format.");
              }
            },
            function (error) {
              $scope.questions = [];
              $scope.quizFinished = true;
              alert("Error loading questions.json");
            }
          );

          // Load states and territories, then combine
          $http.get("states.json").then(
            function (response) {
              $scope.states = response.data;
              $http.get("territories.json").then(
                function (resp) {
                  $scope.territories = resp.data;
                  $scope.combinedStatesTerritories = $scope.states.concat(
                    $scope.territories
                  );
                },
                function () {
                  $scope.combinedStatesTerritories = $scope.states;
                }
              );
            },
            function () {
              $scope.combinedStatesTerritories = [];
            }
          );

          $http.get("governors.json").then(
            function (response) {
              $scope.governors = response.data;
              if (!$scope.governors || $scope.governors.length === 0) {
                console.log("No governors available");
              }
            },
            function (error) {
              $scope.governors = [];
            }
          );

          $http.get("capitals.json").then(
            function (response) {
              $scope.capitals = response.data;
              if (!$scope.capitals || $scope.capitals.length === 0) {
                console.log("No capitals available");
              }
            },
            function (error) {
              $scope.capitals = [];
            }
          );

          $http.get("members.json").then(
            function (response) {
              $scope.congressByState = response.data;
              if (
                !$scope.congressByState ||
                $scope.congressByState.length === 0
              ) {
                console.log("No congress data available");
              }
            },
            function (error) {
              $scope.congressByState = [];
              console.log("Error loading members.json");
            }
          );

          function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
          }

          function speak(text) {
            if ("speechSynthesis" in window) {
              var voices = window.speechSynthesis.getVoices();
              var utter = new SpeechSynthesisUtterance(text);
              // Alternate between male and female voices
              if (!$scope.voiceToggle) $scope.voiceToggle = false;
              var genderVoices = voices.filter(function (v) {
                return v.lang.startsWith("en") && (v.gender ? true : true);
              });
              var femaleVoice = genderVoices.find(function (v) {
                return (
                  v.name.toLowerCase().includes("female") ||
                  v.voiceURI.toLowerCase().includes("female") ||
                  v.name.toLowerCase().includes("woman")
                );
              });
              var maleVoice = genderVoices.find(function (v) {
                return (
                  v.name.toLowerCase().includes("male") ||
                  v.voiceURI.toLowerCase().includes("male") ||
                  v.name.toLowerCase().includes("man")
                );
              });
              if ($scope.voiceToggle && femaleVoice) {
                utter.voice = femaleVoice;
              } else if (!$scope.voiceToggle && maleVoice) {
                utter.voice = maleVoice;
              }
              $scope.voiceToggle = !$scope.voiceToggle;
              window.speechSynthesis.cancel();
              window.speechSynthesis.speak(utter);
            }
          }

          function startFlashcards() {
            //clear this.
            /*      $scope.questions = $scope.questions.filter(function (q) {
                      return q.requiresState === true;
                    });
                    $scope.totalQuestions = $scope.questions.length; */
            //clear this.
            $scope.flashCardQuestions = shuffle($scope.questions).slice(
              0,
              $scope.totalQuestions
            );
            $scope.currentIndex = 0;
            $scope.flashCardsFinished = false;
            //call function to display question
            loadQuestion();
          }

          function loadQuestion() {
            if ($scope.currentIndex < $scope.flashCardQuestions.length) {
              $scope.requiresAdditionalInput = false;
              $scope.currentQuestion =
                $scope.flashCardQuestions[$scope.currentIndex];
              $scope.selectedOptions = [];
              $scope.showAnswers = false;

              var opts = [];
              if ($scope.currentQuestion.requiresState) {
                // Load state-specific data if needed
                var currentStateData = null;
                if (Array.isArray($scope.congressByState)) {
                  currentStateData = $scope.congressByState.find(function (
                    member
                  ) {
                    return member.statecode === $scope.selection.selectedState;
                  });
                } else if (
                  $scope.congressByState &&
                  typeof $scope.congressByState === "object"
                ) {
                  currentStateData =
                    $scope.congressByState[$scope.selection.selectedState];
                }
                if (
                  $scope.currentQuestion.chamber &&
                  $scope.currentQuestion.chamber === "Senate" &&
                  currentStateData
                ) {
                  if (currentStateData.senators) {
                    opts = currentStateData.senators;
                  } else {
                    opts = ["No data found for this state."];
                  }
                } else if (
                  $scope.currentQuestion.chamber &&
                  $scope.currentQuestion.chamber ===
                    "House of Representatives" &&
                  currentStateData
                ) {
                  if (currentStateData.representatives) {
                    opts = currentStateData.representatives;
                  } else {
                    opts = ["No data found for this state."];
                  }
                } else if (
                  $scope.currentQuestion.chamber &&
                  $scope.currentQuestion.chamber === "Governor"
                ) {
                  var governorData = {};
                  governorData = $scope.governors.find(function (g) {
                    return g.statecode === $scope.selection.selectedState;
                  });
                  if (governorData) {
                    opts = [governorData.governorsname];
                  } else {
                    opts = ["No data found for this state."];
                  }
                } else if (
                  $scope.currentQuestion.chamber &&
                  $scope.currentQuestion.chamber === "Capital"
                ) {
                  var capitalData = $scope.capitals.find(function (c) {
                    return c.abbreviation === $scope.selection.selectedState;
                  });
                  if (capitalData) {
                    opts = [capitalData.capitalCity];
                  } else {
                    opts = ["No data found for this state."];
                  }
                }
              } else {
                // Prepare options
                opts = $scope.currentQuestion.answers.slice();
              }
            }
            // Remove duplicates
            $scope.currentOptions = shuffle(Array.from(new Set(opts)));
            var msg = $scope.currentQuestion.question;
            if ($scope.readOutEnabled) {
              $timeout(function () {
                speak(msg);
              }, 100);
            } else {
              $scope.flashCardsFinished = true;
            }
          }

          $scope.showAnswersFn = function () {
            $scope.showAnswers = true;
            if (
              $scope.readOutEnabled &&
              $scope.currentOptions &&
              $scope.currentOptions.length
            ) {
              var msg = "";
              if ($scope.currentOptions.length > 1) {
                msg =
                  "There are " +
                  $scope.currentOptions.length +
                  " possible answers. ";
              }
              var answersText = $scope.currentOptions.join(". ");
              if ($scope.currentQuestion.disclaimer)
                answersText +=
                  ". Disclaimer - " + $scope.currentQuestion.disclaimer + ". ";
              speak(msg + answersText);
            }
          };

          $scope.nextQuestion = function () {
            if ($scope.currentIndex < $scope.flashCardQuestions.length - 1) {
              $scope.currentIndex++;
              loadQuestion();
            } else {
              $scope.flashCardsFinished = true;
            }
          };

          function getCongressMembers() {
            if (
              $scope.congressDataLoading ||
              Object.keys($scope.congressByState).length > 0
            ) {
              return; // Data is loading or already loaded
            }
            $scope.congressDataLoading = true;
            console.log("Starting to fetch all congressional members...");

            var allMembers = [];

            function fetchPage(url) {
              $http.get(url).then(
                function (response) {
                  var apiResponse = response.data;
                  if (apiResponse.members) {
                    allMembers.push.apply(allMembers, apiResponse.members);
                  }
                  // The 'next' URL from the API is a complete URL. Use it directly.
                  if (apiResponse.pagination && apiResponse.pagination.next) {
                    $timeout(function () {
                      fetchPage(
                        apiResponse.pagination.next + "&api_key=" + API_KEY
                      );
                    }, 200);
                  } else {
                    console.log(
                      "Finished fetching. Total members found: " +
                        allMembers.length
                    );
                    processCongressData(allMembers);
                    $scope.congressDataLoading = false;
                  }
                },
                function (error) {
                  console.error(
                    "Error fetching congress data from API:",
                    error
                  );
                  $scope.congressDataLoading = false;
                }
              );
            }
            // Start fetching from the base URL
            $scope.congressurl = $scope.congressurl.replace(
              "{API_KEY}",
              API_KEY
            );
            fetchPage($scope.congressurl);
          }

          function processCongressData(allMembers) {
            // Create sets and maps for efficient lookups.
            // We only care about the 50 states, so we use $scope.states and ignore territories.
            var allStates = [];
            $scope.states.forEach(function (state) {
              allStates.push({
                name: state.name,
                abbreviation: state.abbreviation,
              });
            });
            $scope.territories.forEach(function (territory) {
              allStates.push({
                name: territory.name,
                abbreviation: territory.abbreviation,
              });
            });
            var stateMap = new Map();
            var stateCodeMap = new Map();
            allStates.forEach(function (state) {
              stateMap.set(state.abbreviation, state.name);
              stateCodeMap.set(state.name, state.abbreviation);
            });
            var stateCodes = Array.from(stateMap.keys());

            var processedData = [];
            stateCodes.forEach(function (stateCode) {
              if (stateCode !== "-") {
                processedData.push({
                  statename: stateMap.get(stateCode),
                  statecode: stateCode,
                  senators: [],
                  representatives: [],
                });
              }
            });

            allMembers.forEach(function (member) {
              if (!member || !member.terms || !member.terms.item) {
                console.log("member terms not found!", member);
                return;
              }
              var currentTerm = null;
              member.terms.item.forEach(function (term) {
                if (
                  !term.endYear ||
                  (term.endYear && term.endYear > new Date().getFullYear())
                ) {
                  currentTerm = term;
                }
              });

              if (!currentTerm) {
                console.log(
                  "Skipping member without valid state or term info:",
                  member.name
                );
                return; // Skip territories or members without term info
              }
              var stateCode = stateCodeMap.get(member.state);
              if (!stateCode) {
                console.log("cannonot locate statecode for " + member.state);
              }
              currentData = processedData.find(function (d) {
                return d.statecode === stateCode;
              });
              if (!currentData) {
                console.log("Cannot locate the state" + member.state);
              }
              if (currentTerm.chamber === "Senate") {
                currentData.senators.push(member.name);
              } else if (currentTerm.chamber === "House of Representatives") {
                currentData.representatives.push(member.name);
              }
            });

            $scope.congressByState = processedData;
            console.log($scope.congressByState);
            console.log("Congress data processed and ready.");
          }
        });
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-DZ4QLE2QX7");
    </script>
  </body>
</html>
